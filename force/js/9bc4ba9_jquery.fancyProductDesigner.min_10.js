/*
* Fancy Product Designer - jQuery plugin 2.0.51
* Copyright 2013, Rafael Dery
*
* Only for the sale at the envato marketplaces
*/
!function(a){var b=function(b,c){function d(){var a=document.URL,b=a.indexOf("://")+3,c=a.indexOf("/",b),d=a.substring(b,c),e=d.lastIndexOf(".")-1,f=d.lastIndexOf(".",e)+1;d=d.substring(f,d.length);for(var g=0,h=0;h<d.length;++h){var i=d.charAt(h);g+=i.charCodeAt(0)}return 2512!=g&&1109!=g&&""!=d?!0:!1}var e=a.extend({},a.fn.fancyProductDesigner.defaults,c);e.labels=a.extend({},a.fn.fancyProductDesigner.defaults.labels,e.labels),e.labels.modificationTooltips=a.extend({},a.fn.fancyProductDesigner.defaults.labels.modificationTooltips,e.labels.modificationTooltips),e.labels.colorpicker=a.extend({},a.fn.fancyProductDesigner.defaults.labels.colorpicker,e.labels.colorpicker),e.customImagesParameters=void 0==e.uploadedDesignsParameters?e.customImagesParameters:e.uploadedDesignsParameters,e.customImagesParameters=a.extend({},a.fn.fancyProductDesigner.defaults.customImagesParameters,e.customImagesParameters),e.dimensions=a.extend({},a.fn.fancyProductDesigner.defaults.dimensions,e.dimensions);var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=this,y=null,z=0,A=-1,B=null,C=0,D=null,E=null,F=0,G=new Image,H=new Image;if(G.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QkNGMzVGRDE0NENBMTFFMzlDNTlBQzY1MzlBMkNBNzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QkNGMzVGRDI0NENBMTFFMzlDNTlBQzY1MzlBMkNBNzMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCQ0YzNUZDRjQ0Q0ExMUUzOUM1OUFDNjUzOUEyQ0E3MyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCQ0YzNUZEMDQ0Q0ExMUUzOUM1OUFDNjUzOUEyQ0E3MyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pj80kqoAAAHdSURBVHjalFO7agJREB2Xa6Hio1CIEbSIKIidptJOENJYCraBlGnyCX5BiF8gCUEhWClYhQULIaRUFlQEX4VKCp/gczJ3yW5iYsLmwHL3vs7MnDmX1Wo1IJyYTKYrvV5/hgT4AzqdTtjtdm+LxeJxv9+/AhE4x+PxC03wP5jP52NJkqLMaDRe2u328++RVqsV9Ho9oGhgsVjA6XQe7FPGdqvVegPdbjfzlXk6nWI6nUa/349UEgqCgDabDePxOJbLZflMoVDAVquFk8lEhE6nc6tcpn8MhUJcg1+/ZDKJZrMZ6/U6L+NZJaCUMRKJqAcZYxiLxTCVSqHP5/tB1Gw2cTabfRJks1l10+12Y6VSUcvabreYSCQOCBqNhkzAqC2yKLlcTmkTZDIZiEajqmClUgmq1SqQHvJcGTkYn1ALod1uywsulwtIsAPFA4EAiKKoXuRBPB4PkODAjhgFlKwUeL3eo6binhN4dM5MdcuLg8EAqF2gFYLiXGqPPHLCfD6vmYB34Y4rvVwuMRgMYjgcxuFwqMnOo9FIZDTOOJHBYIBisQhkbXA4HJqC87gCvaoH6ueQL3BltV7ebDZAVr7nGUj9fv+CHsY1ue/0wyh/vmjSaU5Bc+v1+uldgAEAQbiBjYjV1d0AAAAASUVORK5CYII=",H.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RkY3RjhCMTI0NENEMTFFMzlDNTlBQzY1MzlBMkNBNzMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RkY3RjhCMTM0NENEMTFFMzlDNTlBQzY1MzlBMkNBNzMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCQ0YzNUZENzQ0Q0ExMUUzOUM1OUFDNjUzOUEyQ0E3MyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCQ0YzNUZEODQ0Q0ExMUUzOUM1OUFDNjUzOUEyQ0E3MyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pj7soO0AAAG9SURBVHjalFM9awJBEJ07TwstlPMKL4WFVlEsU5lGEMHKQizSSSBlmoA/wH+QP2AlhBSptLESBCtJIyqCH6BgETwFNeeBH+dmdskdhiR3yYMtdnf2zbw3s1y32wVEwOPx3DmdzjBBgAU4juN1XV9ut9un0+n0CkggK4rSIv8APiSqqir9fv9acLvdt5IkXU0mE2g0GsDzPOz3e/D5fJDJZEAQhJ+qAKxYwpgHvBcC9LDZbEI+n2cBsixDuVwGh8NhpYaSizxWpNONy+UyL7AiiEajLJMVqBre2GiaBsFgENLpNHQ6HYjH49But8EOJoEoilAqlaBarUIymYTpdArL5dKWgAY+Gs4aWCwWpNWyb8x8Pq8L584a8Pv9bJ0DE7AO/SrBCrVaDRKJBIxGI7Yfj8es1SypIcFqaHK5HJ1OEolESKVSIalUiux2O4Ie1W0JKFarFclms4yErnCYTTwj4P8iw+v1QqFQMAcL/4JpgYBE73YEw+EQisUixGIxOjwQCoUMYzXo9XqXm83mzUrC4XAgx+PxyxmaSAaDwQ2toD+bzdJY5j3O9sWnzm+f56zNHGZW1+v1M5K8fAgwAKZZlVqllD6aAAAAAElFTkSuQmCC",d())return!1;g=a(b).addClass("fpd-container fpd-clearfix"),s=g.children(".fpd-product").remove(),t=g.children(".fpd-design");var I=document.createElement("canvas"),J=Boolean(I.getContext&&I.getContext("2d"));if(!J)return a.post(e.templatesDirectory+"canvaserror.php",function(b){g.append(a.parseHTML(b)),g.trigger("templateLoad",[this.url])}),g.trigger("canvasFail"),!1;window.localStorage.length,a.post(e.templatesDirectory+"sidebar.php",function(b){g.append(a.parseHTML(b)),h=g.children(".fpd-sidebar"),i=h.children(".fpd-navigation"),j=h.children(".fpd-content"),m=j.find(".fpd-toolbar"),n=m.children(".fpd-element-buttons"),o=m.children(".fpd-color-picker"),q=m.children(".fpd-patterns-wrapper"),g.hasClass("fpd-horizontal")?(h.css("width",e.dimensions.sidebarHeight),i.find("li").css("line-height",e.dimensions.sidebarNavWidth+"px"),i.css("height",e.dimensions.sidebarNavWidth)):(h.css("height",e.dimensions.sidebarHeight),i.css("width",e.dimensions.sidebarNavWidth),j.css("width",e.dimensions.sidebarContentWidth)),g.trigger("templateLoad",[this.url]),a.post(e.templatesDirectory+"productstage.php",function(b){g.append(a.parseHTML(b)),k=g.children(".fpd-product-container").css({width:e.dimensions.productStageWidth}),k.children(".fpd-product-stage").height(e.dimensions.productStageHeight),l=k.children(".fpd-menu-bar"),w=k.append('<div class="fpd-product-loader"><div class="fpd-loading-gif"></div></div>').children(".fpd-product-loader"),g.trigger("templateLoad",[this.url]),K()})});var K=function(){var b=k.children(".fpd-product-stage").children("canvas").get(0);f=new fabric.Canvas(b,{selection:!1,hoverCursor:"pointer",rotationCursor:"default"}),f.setDimensions({width:e.dimensions.productStageWidth,height:e.dimensions.productStageHeight}),r=k.append('<div class="fpd-modification-tooltip"></div>').children(".fpd-modification-tooltip").tooltipster({offsetY:-3,theme:".fpd-tooltip-theme",delay:0,speed:0,touchDevices:!1}),f.on({"mouse:down":function(a){void 0==a.target&&Q()},"object:moving":function(a){E.params.x=Math.round(a.target.left),E.params.y=Math.round(a.target.top),R(a.target),E.lockMovementX||(N(e.labels.modificationTooltips.x+Math.round(a.target.left)+e.labels.modificationTooltips.y+Math.round(a.target.top),"moved"),$(E))},"object:scaling":function(a){E.params.scale=Number(a.target.scaleX).toFixed(2),E.params.x=Math.round(a.target.left),E.params.y=Math.round(a.target.top),a.target.setCoords(),R(a.target),E.lockScalingX||(N(e.labels.modificationTooltips.width+Math.round(E.getWidth())+e.labels.modificationTooltips.height+Math.round(E.getHeight()),"scaled"),$(E))},"object:rotating":function(a){E.params.degree=Math.round(a.target.angle),R(a.target),E.lockRotation||(N(e.labels.modificationTooltips.angle+Math.round(a.target.angle)%360,"rotated"),$(E))},"object:selected":function(a){Q(!1),E=a.target;var b=E.params;if($(E),E.set({borderColor:"white",cornerColor:"transparent",cornerSize:16,rotatingPointOffset:0,padding:7}),j.find(".fpd-elements-dropdown").children('option[value="'+E.id+'"]').prop("selected",!0).parent().trigger("chosen:updated"),Array.isArray(b.colors)&&0!=ab(E)?(o.children("input").val(b.currentColor?b.currentColor:b.colors[0]),b.colors.length>1?o.children("input").spectrum({preferredFormat:"hex",showPaletteOnly:!0,showPalette:!0,palette:b.colors,chooseText:e.labels.colorpicker.change,cancelText:e.labels.colorpicker.cancel,change:function(a){O(E,a.toHexString())}}):o.children("input").spectrum("destroy").spectrum({preferredFormat:"hex",showInput:!0,chooseText:e.labels.colorpicker.change,cancelText:e.labels.colorpicker.cancel,change:function(a){O(E,a.toHexString())}}),o.show()):o.hide(),"text"==E.type&&(p.children('option[value="'+b.font+'"]').prop("selected","selected").trigger("chosen:updated"),p.parent().show(),m.children(".fpd-customize-text").show().children("textarea").val(E.getText()),b.patternable&&q.show()),b.draggable?n.children(".fpd-center-horizontal, .fpd-center-vertical").show():n.children(".fpd-center-horizontal, .fpd-center-vertical").hide(),b.zChangeable?n.children(".fpd-move-down, .fpd-move-up").show():n.children(".fpd-move-down, .fpd-move-up").hide(),b.removable?n.children(".fpd-trash").show():n.children(".fpd-trash").hide(),b.boundingBox&&!e.editorMode)if("object"==typeof b.boundingBox)y=new fabric.Rect({left:b.boundingBox.x,top:b.boundingBox.y,width:b.boundingBox.width,height:b.boundingBox.height,stroke:"blue",strokeWidth:1,fill:!1,selectable:!1,isBoundingRect:!0,originX:"center",originY:"center"}),f.add(y),y.moveTo(f.getObjects().indexOf(E));else for(var c=f.getObjects(),d=0;d<c.length;++d){var h=c[d];if(h.viewIndex==C&&b.boundingBox==h.title&&null==y){y=h,h.stroke="blue",h.strokeWidth=1;break}}f.renderAll(),m.show(),i.find('li[data-target=".fpd-edit-elements"]').click(),R(E),g.trigger("elementSelect",[E])}});for(var c=[],d=0;d<s.length;++d){c=a(s.get(d)).children(".fpd-product"),c.splice(0,0,s.get(d));var h=[];c.each(function(b,c){var d=a(c),e={title:c.title,thumbnail:d.data("thumbnail"),elements:[]};d.children("img,span").each(function(b,c){var d=a(c),f={type:d.is("img")?"image":"text",source:d.is("img")?d.attr("src"):d.text(),title:d.attr("title"),parameters:void 0==d.data("parameters")?{}:d.data("parameters")};e.elements.push(f)}),h.push(e)}),x.addProduct(h)}if(t.size()>0){if(t.children(".fpd-category").length>0){var u=t.children(".fpd-category");$designCategories=j.find(".fpd-designs").prepend('<select class="fpd-design-categories" style="width: 100%;" tabindex="1"></select>').children(".fpd-design-categories").change(function(){var b=u.filter('[title="'+this.value+'"]').children("img");j.find(".fpd-designs ul").empty();for(var c=0;c<b.length;++c)x.addDesign(a(b[c]).attr("src"),b[c].title,a(b[c]).data("parameters"))}),e._useChosen&&$designCategories.chosen({width:"100%"});for(var d=0;d<u.length;d++)$designCategories.append('<option value="'+u[d].title+'">'+u[d].title+"</option>").trigger("chosen:updated");$designCategories.change()}else for(var z=t.children("img"),d=0;d<z.length;++d)x.addDesign(a(z[d]).attr("src"),z[d].title,a(z[d]).data("parameters"));t.remove()}if(i.find('li[data-target=".fpd-edit-elements"]').show(),e.customTexts){var A=j.children(".fpd-custom-text"),B=A.children("textarea").val();i.find('li[data-target=".fpd-custom-text"]').show(),A.children(".fpd-button-submit").click(function(a){a.preventDefault();var b=A.children("textarea").val();x.addElement("text",b,b,e.customTextParameters,C),A.children("textarea").removeClass("fpd-active").val(B)}),A.children("textarea").focusin(function(){var b=a(this);this.value==B&&(b.addClass("fpd-active"),this.value="")}).focusout(function(){var b=a(this);""==this.value&&(this.value=B,b.removeClass("fpd-active"))})}if(e.uploadDesigns){var G=j.children(".fpd-upload-designs");i.find('li[data-target=".fpd-upload-designs"]').show(),G.children(".fpd-button-submit").click(function(a){a.preventDefault(),G.find(".fpd-input-design").click()}),G.find(".fpd-upload-form").change(function(a){if(window.FileReader){var b=new FileReader,c=a.target.files[0].name;b.readAsDataURL(a.target.files[0]),b.onload=function(a){var b=new Image;b.src=a.target.result,b.onload=function(){var b=this.height,d=this.width;return d>e.customImagesParameters.maxW||d<e.customImagesParameters.minW||b>e.customImagesParameters.maxH||b<e.customImagesParameters.minH?(alert(e.labels.uploadedDesignSizeAlert),!1):(e.customImagesParameters.scale=Y(d,b,e.customImagesParameters.resizeToW,e.customImagesParameters.resizeToH),x.addElement("image",a.target.result,c,e.customImagesParameters),void 0)},b.onerror=function(){alert("Image could not be loaded!")}}}else alert("FileReader API is not supported in your browser, please use Firefox, Safari, Chrome or IE10!")})}if(e.facebookAppId&&e.facebookAppId.length>0){var H=j.children(".fpd-fb-user-photos"),I=H.find("select"),J=H.find(".fpd-fb-user-photos-list"),K=H.find(".fpd-loading-gif");i.find('li[data-target=".fpd-fb-user-photos"]').show(),e._useChosen&&I.chosen({width:"100%"});var L=H.find(".fpd-fb-friends-select").change(function(){K.show();var b=a(this).children("option:selected").val();J.empty().css("visibility","hidden"),M.children("option:not(:first)").remove(),FB.api("/"+b+"/albums",function(a){for(var b=a.data,c=0;c<b.length;++c){var d=b[c];M.append('<option value="'+d.id+'">'+d.name+"</option>")}M.trigger("chosen:updated").next(".chosen-container").show(),K.hide()})}),M=H.find(".fpd-fb-user-albums").change(function(){K.show();var b=a(this).children("option:selected").val();J.css("visibility","hidden").empty(),FB.api("/"+b,function(c){var d=c.count;FB.api("/"+b+"?fields=photos.limit("+d+")",function(b){if(!b.error){for(var c=b.photos.data,d=0;d<c.length;++d){var f=c[d],g=f.images[f.images.length-1]?f.images[f.images.length-1].source:f.source;J.append('<li><span class="fpd-loading-gif"></span><img src="'+g+'" title="'+f.id+'" data-picture="'+f.source+'" style="display: none;" /></li>').children("li:last").click(function(b){b.preventDefault(),w.show();var c=a(this).children("img");a.post(e.phpDirectory+"get_image_data_url.php",{url:c.data("picture")},function(a){if(a&&void 0==a.error){var b=new Image;b.src=a.data_url,b.onload=function(){e.customImagesParameters.scale=Y(this.width,this.height,e.customImagesParameters.resizeToW,e.customImagesParameters.resizeToH),x.addElement("image",this.src,c.attr("title"),e.customImagesParameters,C)}}else alert(a.error);w.hide()},"json").fail(function(a){w.hide(),alert(a.statusText)})}).children("img").load(function(){a(this).fadeIn(500).prev("span").fadeOut(300,function(){a(this).remove()})}).error(function(){a(this).parent().remove()})}X(J),J.css("visibility","visible")}K.hide()})})});a.ajaxSetup({cache:!0}),a.getScript("//connect.facebook.net/en_UK/all.js",function(){FB.init({appId:e.facebookAppId,status:!0,cookie:!0,xfbml:!0}),FB.Event.subscribe("auth.statusChange",function(a){"connected"===a.status?(K.show(),FB.api("/me",function(a){L.append('<option value="'+a.id+'">'+a.name+"</option>"),FB.api("/me/friends",function(a){for(var b=a.data.sort(Z),c=0;c<b.length;++c){var d=b[c];L.append('<option value="'+d.id+'">'+d.name+"</option>")}L.trigger("chosen:updated").next(".chosen-container").show()}),K.hide()})):(J.empty().css("visibility","hidden"),I.children("option:not(:first)").remove(),I.trigger("chosen:updated").next(".chosen-container").hide())})})}if(e.allowProductSaving&&g.attr("id")){i.find('li[data-target=".fpd-saved-products"]').show(),l.find(".fpd-save-product").click(function(a){a.preventDefault(),Q();var b=x.getProduct(!1),c=x.getViewsDataURL()[0],d=S();null==d&&(d=new Array),d.push({thumbnail:c,product:b}),window.localStorage.setItem(g.attr("id"),JSON.stringify(d)),W(c,b)});var P=S();if(null!=P)for(var d=0;d<P.length;++d){var T=P[d];W(T.thumbnail,T.product)}}else l.find(".fpd-save-product").parent().hide();if(e.saveAsPdf&&window.jsPDF?l.find(".fpd-save-pdf").click(function(a){a.preventDefault(),Q();for(var b=new jsPDF,c=x.getViewsDataURL("jpeg","white"),d=0;d<c.length;++d)b.addImage(c[d],"JPEG",0,0),d<c.length-1&&b.addPage();b.save("Product.pdf")}):l.find(".fpd-save-pdf").parent().hide(),i.find("ul li").click(function(b){b.preventDefault();var c=a(this);if(!c.hasClass("fpd-content-color")){c.parent().children("li").removeClass("fpd-content-color"),c.addClass("fpd-content-color"),j.children("div").hide().children("ul").getNiceScroll().remove();var d=j.children(c.data("target")).show();d.children("ul").size()>0&&X(d.children("ul"))}}).filter(":visible:first").click(),j.find(".fpd-elements-dropdown").change(function(){if("none"==this.value)Q();else for(var a=f.getObjects(),b=0;b<a.length;++b)if(a[b].id==this.value){f.setActiveObject(a[b]);break}}),e.fonts.length>0&&e.fontDropdown){p=m.find(".fpd-fonts-dropdown").change(function(){E.getWidth(),E.setFontFamily(this.value),E.params.font=this.value,_(this.value),R(E),f.renderAll(),p.trigger("chosen:updated")}),e._useChosen&&p.chosen({width:"100%"}),e.fonts.sort(),0==e.defaultFont&&(e.defaultFont=e.fonts[0]);for(var d=0;d<e.fonts.length;++d)p.append('<option value="'+e.fonts[d]+'" style="font-family: '+e.fonts[d]+';">'+e.fonts[d]+"</option>").trigger("chosen:updated");p.children('option[value="'+e.defaultFont+'"]').prop("selected","selected"),p.parent().show()}if(m.children(".fpd-customize-text").children("textarea").keyup(function(){E.setText(this.value),E.params.text=this.value,f.renderAll(),R(E)?N():r.tooltipster("hide")}),m.find(".fpd-text-styles").children("button").click(function(b){b.preventDefault();var c=a(this);c.hasClass("fpd-align-left")?(E.setTextAlign("left"),E.params.textAlign="left"):c.hasClass("fpd-align-center")?(E.setTextAlign("center"),E.params.textAlign="center"):c.hasClass("fpd-align-right")?(E.setTextAlign("right"),E.params.textAlign="right"):c.hasClass("fpd-bold")?"bold"==E.getFontStyle()?(E.setFontStyle("normal"),E.params.fontStyle="normal"):(E.setFontStyle("bold"),E.params.fontStyle="bold"):c.hasClass("fpd-italic")&&("italic"==E.getFontStyle()?(E.setFontStyle("normal"),E.params.fontStyle="normal"):(E.setFontStyle("italic"),E.params.fontStyle="italic")),f.renderAll()}),e.patterns&&e.patterns.length>0){for(var d=0;d<e.patterns.length;++d){var V=e.patterns[d];q.children("ul").append('<li><img src="'+V+'" class="" /></li>').children("li:last").click(function(){bb(a(this).children("img").attr("src"),E)})}q.children("ul").niceScroll({cursorcolor:"#2E3641"})}n.children(".fpd-center-horizontal, .fpd-center-vertical").click(function(b){b.preventDefault();var c=a(this);U(E,c.hasClass("fpd-center-horizontal"),c.hasClass("fpd-center-vertical"),y?y.getBoundingRect():!1)}),n.children(".fpd-move-down, .fpd-move-up").click(function(b){b.preventDefault();for(var c,d=f.getObjects(),e=null,g=null,h=0;h<d.length;++h)d[h].viewIndex==C&&(null==e&&(e=h),null==g?g=h:g++),d[h]==E&&(c=h);c>g&&(c=g),e>c&&(c=e),a(this).hasClass("fpd-move-down")?c!=e&&E.moveTo(c-1):c!=g&&E.moveTo(c+1)}),n.children(".fpd-reset").click(function(a){if(a.preventDefault(),E){var b=E.params;"text"==E.type&&(E.fontSize=b.textSize,E.setText(b.source),E.setFontFamily(b.originFont),E.setTextAlign("left"),E.setFontStyle("normal"),m.children(".fpd-customize-text").children("textarea").val(b.source),p.children('option[value="'+e.defaultFont+'"]').prop("selected","selected")),E.left=b.originX,E.top=b.originY,E.scaleX=b.originScale,E.scaleY=b.originScale,E.angle=0,b.colors&&b.currentColor!=b.colors[0]&&O(E,b.colors[0]),R(E),f.renderAll(),b.x=b.originX,b.y=b.originY,b.degree=0,E.params=b}}),n.children(".fpd-trash").click(function(a){a.preventDefault(),0!=E.params.price&&(F-=E.params.price,g.trigger("priceChange",[E.params.price,F])),j.find(".fpd-elements-dropdown").children('option[value="'+E.id+'"]').remove().trigger("chosen:updated"),E.remove(),g.trigger("elementRemove",[E]),Q()}),l.find(".fpd-download-image").click(function(a){a.preventDefault(),x.createImage(!0,!0)}),l.find(".fpd-print").click(function(a){a.preventDefault(),x.print()}),l.find(".fpd-reset-product").click(function(a){a.preventDefault(),x.loadProduct(D)}),e._useChosen&&j.find(".fpd-elements-dropdown").chosen({width:"100%"}),g.find(".chosen-container").addClass("fpd-border-color"),e.editorMode&&a.post(e.templatesDirectory+"editorbox.php",function(b){g.after(a.parseHTML(b)),v=g.next(".fpd-editor-box")}),g.trigger("ready"),j.find(".fpd-products ul li:first").size()>0?j.find(".fpd-products ul li:first").click():w.hide()},L=function(a){var b=a.params;return("object"==typeof b.colors||b.removable||b.draggable||b.resizable||b.rotatable||b.zChangeable)&&(a.isEditable=a.evented=!0,a.set("selectable",!0),a.viewIndex==C&&j.find(".fpd-elements-dropdown").append('<option value="'+a.id+'">'+a.title+"</option>").trigger("chosen:updated")),e.editorMode?!1:(b.draggable&&(a.lockMovementX=a.lockMovementY=!1),b.rotatable&&(a.lockRotation=!1),b.resizable&&(a.lockScalingX=a.lockScalingY=!1),(b.resizable||b.rotatable)&&(a.hasControls=!0),void 0)},M=function(a,b){function c(){if(e++,e<b.length){var d=b[e];x.addElement(d.type,d.source,d.title,d.parameters,z-1)}else g.off("elementAdded",c),g.trigger("viewCreate",[b,a])}var d=b[0];if(d){var e=0;g.on("elementAdded",c),x.addElement(d.type,d.source,d.title,d.parameters,z-1)}else g.trigger("viewCreate",[b,a])},N=function(a,b){var c=E.left,d=E.top;E.setCoords(),"moved"==b?(c=E.oCoords.tl.x,d=E.oCoords.tl.y):"scaled"==b?(c=E.oCoords.br.x,d=E.oCoords.br.y):(c=E.oCoords.mt.x,d=E.oCoords.mt.y),E.isOut&&(a='"'+E.title+'"'+e.labels.outOfContainmentAlert),r.css({left:c,top:d+l.height()}).tooltipster("reposition").tooltipster("show").tooltipster("update",a),f.on({"mouse:up":function(){r.tooltipster("hide"),f.off("mouseup")}})},O=function(a,b){if(4==b.length&&(b+=b.substr(1,b.length)),"text"==a.type)a.setFill(b),f.renderAll(),a.params.pattern=null;else{var c=ab(a);"png"==c?(a.filters.push(new fabric.Image.filters.Tint({color:b,opacity:1})),a.applyFilters(f.renderAll.bind(f))):"svg"==c&&a.setFill(b)}a.params.currentColor=b,o.children("input").spectrum("set",b),P(a,b),$(a)},P=function(a,b){if(a.colorControlFor)for(var c=a.colorControlFor,d=0;d<c.length;++d)O(c[d],b)},Q=function(a){a="undefined"==typeof a?!0:a,y&&(y.isBoundingRect&&y.remove(),y.stroke=null,y=null),a&&f.discardActiveObject(),f.renderAll(),j.find(".fpd-elements-dropdown").children("option:first").prop("selected",!0).trigger("chosen:updated"),m.hide().children(".fpd-color-picker, .fpd-fonts-dropdown-wrapper, .fpd-customize-text").hide(),q.hide(),m.children(".fpd-customize-text").children("textarea").val(""),E=null,v&&v.find("i").text("")},R=function(a){if(y){a.setCoords();var b=(a.getBoundingRect(),y.getBoundingRect(),!1),c=a.isOut,b=!a.isContainedWithinObject(y);return b?(a.borderColor="red",a.opacity=.5,a.isOut=!0):(a.borderColor="white",a.opacity=1,a.isOut=!1),c!=a.isOut&&void 0!=c&&(b?g.trigger("elementOut"):g.trigger("elementIn")),b}return!1},S=function(){return JSON.parse(window.localStorage.getItem(g.attr("id")))},T=function(a){a.params.boundingBox?V(a):U(a,!0,!0,!1),a.params.autoCenter=!1},U=function(a,b,c,d){b&&(d?a.left=d.left+.5*d.width:a.centerH()),c&&(d?a.top=d.top+.5*d.height:a.centerV()),R(a),f.renderAll(),a.setCoords(),a.params.x=a.left,a.params.y=a.top},V=function(a){var b=a.params;if(b.boundingBox){var c;if("object"==typeof b.boundingBox)c={left:b.boundingBox.x-.5*b.boundingBox.width,top:b.boundingBox.y-.5*b.boundingBox.height,width:b.boundingBox.width,height:b.boundingBox.height};else for(var d=f.getObjects(),e=0;e<d.length;++e){var g=d[e];if(g.viewIndex==C&&b.boundingBox==g.title){c=g.getBoundingRect();break}}c&&(U(a,!0,!0,c),a.params.originX=a.left,a.params.originY=a.top)}},W=function(b,c){var d=j.children(".fpd-saved-products").children("ul");d.append('<li><button><span>&times;</span></button><img src="'+b+'" /></li>').children("li:last").children("img").click(function(b){b.preventDefault(),x.loadProduct(a(this).data("product")),A=-1}).data("product",c).parent().children("button").click(function(b){b.preventDefault();var c=confirm(e.labels.confirmProductDelete);if(!c)return!1;var f=d.children("li").index(a(this).parent("li").remove()),h=S();h.splice(f,1),window.localStorage.setItem(g.attr("id"),JSON.stringify(h))})},X=function(a){a.height(a.parent().height()-a.position().top-1).niceScroll({cursorcolor:"#2E3641"})},Y=function(a,b,c,d){var e=1;return a>b?(a>c&&(e=c/a),e*b>d&&(e=d/b)):(b>d&&(e=d/b),e*a>c&&(e=c/a)),e},Z=function(a,b){var c=a.name.toLowerCase(),d=b.name.toLowerCase();return d>c?-1:c>d?1:0},$=function(a){if(void 0==v)return!1;var b=a.params;v.find(".fpd-current-element").text(a.title),v.find(".fpd-position").text("x: "+b.x+" y: "+b.y),v.find(".fpd-dimensions").text("width: "+Math.round(a.getWidth())+" height: "+Math.round(a.getHeight())),v.find(".fpd-scale").text(Number(b.scale)%360),v.find(".fpd-degree").text(b.degree),v.find(".fpd-color").text(b.currentColor)},_=function(a){WebFont.load({custom:{families:[a]},fontactive:function(){f.renderAll()}})},ab=function(b){if("text"==b.type)return"text";var c=b.source.split(".");return 1==c.length?-1==c[0].search("data:image/png;")?(b.params.currentColor=b.params.colors=!1,!1):"dataurl":-1==a.inArray("png",c)&&-1==a.inArray("svg",c)?(b.params.currentColor=b.params.colors=!1,!1):-1==a.inArray("svg",c)?"png":"svg"},bb=function(a,b){"image"==b.type||"text"==b.type&&fabric.util.loadImage(a,function(c){b.fill=new fabric.Pattern({source:c,repeat:"repeat"}),f.renderAll(),b.params.pattern=a})},cb=function(a,b){for(var c=f.getObjects(),d=0,e=0;e<c.length;++e){var g=c[e];if(g.visible){if(d==b){a.moveTo(e);break}d++}}};this.getFabricJSON=function(){Q();var a=f.toJSON(["viewIndex"]);return a.width=f.width,a.height=f.height,a},this.getPrice=function(){return F},this.getProduct=function(a){onlyEditableElemets="undefined"!=typeof a?a:!1,Q();for(var b=f.getObjects(),c=0;c<b.length;++c){var d=b[c];if(d.isOut)return alert('"'+d.title+'"'+e.labels.outOfContainmentAlert),!1}for(var g=[],c=0;c<D.length;++c){var h=D[c];g.push({title:h.title,thumbnail:h.thumbnail,elements:[]})}for(var c=0;c<b.length;++c){var d=b[c],i={title:d.title,source:d.source,parameters:d.params,type:d.type};a?d.isEditable&&g[d.viewIndex].elements.push(i):g[d.viewIndex].elements.push(i)}return g},this.getViewsDataURL=function(a,b){a="undefined"!=typeof a?a:"png",b="undefined"!=typeof b?b:"transparent";var c=[];return f.setBackgroundColor(b,function(){for(var b=f.getObjects(),d=0;z>d;++d){for(var e=0;e<b.length;++e){var g=b[e];g.visible=g.viewIndex==d}c.push(f.toDataURL({format:a}))}for(var d=0;d<b.length;++d){var g=b[d];g.visible=g.viewIndex==C}f.setBackgroundColor("transparent").renderAll()}),c},this.getProductDataURL=function(a,b){a="undefined"!=typeof a?a:"png",b="undefined"!=typeof b?b:"transparent",Q(),u.children("li:first").click();var c;return f.setBackgroundColor(b,function(){f.setDimensions({height:e.dimensions.productStageHeight*z});for(var b=f.getObjects(),d=0;d<b.length;++d){var g=b[d];g.visible=!0,g.top=g.top+g.viewIndex*e.dimensions.productStageHeight}c=f.toDataURL({format:a}),f.setDimensions({height:e.dimensions.productStageHeight});for(var d=0;d<b.length;++d){var g=b[d];g.visible=0==g.viewIndex,g.top=g.top-g.viewIndex*e.dimensions.productStageHeight}f.setBackgroundColor("transparent").renderAll()}),c},this.getProductsLength=function(){return j.find(".fpd-products ul li").size()},this.getView=function(){return D[C]},this.getViewDataURL=function(a){return a="undefined"!=typeof a?a:"png",f.toDataURL({format:a})},this.getViewIndex=function(){return C},this.getStage=function(){return f},this.addProduct=function(b){j.find(".fpd-products ul").append('<li><span class="fpd-loading-gif"></span><img src="'+b[0].thumbnail+'" title="'+b[0].title+'" style="display:none;" /></li>').children("li:last").click(function(b){b.preventDefault();var c=a(this),d=j.find(".fpd-products ul li").index(c);x.selectProduct(d)}).data("views",b).children("img").load(function(){a(this).fadeIn(500).prev("span").fadeOut(300,function(){a(this).remove()})}),j.find(".fpd-designs ul").getNiceScroll().resize(),j.find(".fpd-products ul").children("li").length>1&&i.find('li[data-target=".fpd-products"]').show()},this.loadProduct=function(a){function b(){z<D.length?x.addView(D[z]):(g.off("viewCreate",b),g.trigger("productCreate",[B]),w.stop().fadeOut(300))}x.clear(),w.stop().fadeIn(300),D=a,B=D[0].title,k.append('<ul class="fpd-views-selection"></ul>'),g.on("viewCreate",b),x.addView(D[0])},this.selectProduct=function(a){if(a==A)return!1;A=a,0>a?A=0:a>x.getProductsLength()-1&&(A=x.getProductsLength()-1);var b=j.find(".fpd-products ul li").eq(A).data("views");x.loadProduct(b)},this.selectView=function(a){if(a==C)return!1;C=a,0>a?C=0:a>u.children("li").size()-1&&(C=u.children("li").size()-1),Q(),j.find(".fpd-elements-dropdown").children('option:not([value="none"])').remove();for(var b=f.getObjects(),c=0;c<b.length;++c){var d=b[c];d.visible=d.viewIndex==C,d.viewIndex==C&&d.isEditable&&j.find(".fpd-elements-dropdown").append('<option value="'+d.id+'">'+d.title+"</option>")}j.find(".fpd-elements-dropdown").trigger("chosen:updated"),f.renderAll()},this.removeProduct=function(a){0>a?a=0:a>x.getProductsLength()-1&&(a=x.getProductsLength()-1),h.children("li").eq(a).remove(),a==A&&(x.clear(),A=-1)},this.addView=function(b){z++,M(b.title,b.elements),u=k.children(".fpd-views-selection"),u.append('<li class="fpd-content-color"><img src="'+b.thumbnail+'" title="'+b.title+'" class="fpd-tooltip" /></li>').children("li:last").click(function(b){b.preventDefault(),x.selectView(u.children("li").index(a(this)))}),a(".fpd-tooltip").tooltipster({offsetY:-3,theme:".fpd-tooltip-theme",touchDevices:!1}),z>1?u.show():u.hide()},this.addElement=function(b,c,d,h,i){if(i="undefined"!=typeof i?i:C,Q(),"object"!=typeof h)return alert("The element "+d+" has not a valid JSON object as parameters!"),!1;h=a.extend({},e.elementParameters,h),h.originX=h.x,h.originY=h.y,h.originScale=h.scale,h.source=c;var j=!1,k=null;if(h.colors&&"string"==typeof h.colors)if(0==h.colors.indexOf("#")){var l=h.colors.replace(/\s+/g,"").split(",");h.colors=l}else if(z>1)for(var m=f.getObjects(),n=0;n<m.length;++n){var o=m[n];0==o.viewIndex&&h.colors==o.title&&null==k&&(k=o,j=!0)}var p={source:c,title:d,top:h.y,left:h.x,originX:"center",originY:"center",scaleX:h.scale,scaleY:h.scale,angle:h.degree,id:String((new Date).getTime()),visible:i==C,viewIndex:i,lockUniScaling:!0,lineHeight:1.2};if(e.editorMode?h.removable=h.resizable=h.rotatable=h.zChangeable=!0:a.extend(p,{selectable:!1,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockMovementX:!0,lockMovementY:!0,hasControls:!1,evented:!1}),"image"==b||"path"==b){var q=function(b,c){b.width*c.scale,b.height*c.scale,a.extend(p,{scaleX:c.scale,scaleY:c.scale,params:c,crossOrigin:"anonymous"}),b.set(p),j&&(k.colorControlFor?k.colorControlFor.push(b):(k.colorControlFor=[],k.colorControlFor.push(b))),L(b),f.add(b),c.autoCenter&&T(b),c.currentColor&&O(b,c.currentColor),c.z!==!1&&cb(b,c.z),g.trigger("elementAdded",[b])},r=c.split(".");-1!=a.inArray("svg",r)?fabric.loadSVGFromURL(c,function(a){a=a[0],q(a,h)}):new fabric.Image.fromURL(c,function(a){q(a,h)})}else{if("text"!=b)return alert("Sorry. This type of element is not allowed!"),!1;h.text=h.text?h.text:h.source,h.font=h.font?h.font:e.defaultFont,h.textSize=h.textSize?h.textSize:e.textSize,h.fontStyle=h.fontStyle?h.fontStyle:"normal",h.textAlign=h.textAlign?h.textAlign:"left",h.originFont=h.font,a.extend(p,{fontSize:h.textSize,fontFamily:h.font,fontStyle:h.fontStyle,textAlign:h.textAlign,fill:h.colors[0]?h.colors[0]:"#000000",params:h});var s=new fabric.Text(h.text.replace(/\\n/g,"\n"),p);f.add(s),L(s),h.autoCenter&&T(s),h.currentColor&&O(s,h.currentColor),h.pattern&&bb(h.pattern,s),h.z!==!1&&cb(s,h.z),_(h.font),g.trigger("elementAdded",[s])}h.price&&(F+=h.price,g.trigger("priceChange",[h.price,F]))},this.addDesign=function(b,c,d){j.find(".fpd-designs ul").append('<li><span class="fpd-loading-gif"></span><img src="'+b+'" title="'+c+'" style="display: none;" /></li>').children("li:last").click(function(b){b.preventDefault();var c=a(this),d=c.data("parameters");x.addElement("image",c.children("img").attr("src"),c.children("img").attr("title"),d,C)
}).data("parameters",d).children("img").load(function(){a(this).fadeIn(500).prev("span").fadeOut(300,function(){a(this).remove()})}),j.find(".fpd-designs ul").getNiceScroll().resize(),j.find(".fpd-designs ul li").length>0&&i.find('li[data-target=".fpd-designs"]').show()},this.print=function(){var b=new Image;return b.src=x.getProductDataURL(),b.onload=function(){var b=window.open("","","width="+this.width+",height="+this.height+",location=no,menubar=no,scrollbars=yes,status=no,toolbar=no");b.document.title="Print Image",a(b.document.body).append('<img src="'+this.src+'" />'),setTimeout(function(){b.print()},1e3)},!1},this.createImage=function(b,c){"undefined"==typeof b&&(b=!0),"undefined"==typeof c&&(c=!1);var d=x.getProductDataURL(),e=new Image;return e.src=d,e.onload=function(){if(b){var e=window.open("","","width="+this.width+",height="+this.height+",location=no,menubar=no,scrollbars=yes,status=no,toolbar=no");e.document.title="Product Image",a(e.document.body).append('<img src="'+this.src+'" />'),c&&(window.location.href=e.document.getElementsByTagName("img")[0].src.replace("image/png","image/octet-stream"))}g.trigger("imageCreate",[d])},e},this.clear=function(){Q(),u&&u.remove(),j.find(".fpd-elements-dropdown").children('option:not([value="none"])').remove(),j.find(".fpd-elements-dropdown").trigger("chosen:updated"),f.clear(),z=C=F=0,D=E=null,g.trigger("stageClear")},fabric.Object.prototype.drawControls=function(a){if(!this.hasControls)return this;var b,c,d=this.cornerSize,e=d/2,f=~~(this.strokeWidth/2),g=-(this.width/2),h=-(this.height/2),i=d/this.scaleX,j=d/this.scaleY,k=this.padding/this.scaleX,l=this.padding/this.scaleY,m=e/this.scaleY,n=e/this.scaleX,o=(e-d)/this.scaleX,p=(e-d)/this.scaleY,q=this.height,r=this.width,s=this.transparentCorners?"strokeRect":"fillRect",t=this.transparentCorners,u="undefined"!=typeof G_vmlCanvasManager;return a.save(),a.lineWidth=1/Math.max(this.scaleX,this.scaleY),a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,a.strokeStyle=a.fillStyle=this.cornerColor,b=g-n-f-k,c=h-m-f-l,u||t||a.clearRect(b,c,i,j),b=g+r-n+f+k,c=h-m-f-l,u||t||a.clearRect(b,c,i,j),b=g-n-f-k,c=h+q+p+f+l,u||t||a.clearRect(b,c,i,j),b=g+r+o+f+k,c=h+q+p+f+l,u||t||a.clearRect(b,c,i,j),this.lockScalingX||(a.drawImage(H,b,c,i,j),a[s](b,c,i,j)),this.get("lockUniScaling")||(b=g+r/2-n,c=h-m-f-l,u||t||a.clearRect(b,c,i,j),a[s](b,c,i,j),b=g+r/2-n,c=h+q+p+f+l,u||t||a.clearRect(b,c,i,j),a[s](b,c,i,j),b=g+r+o+f+k,c=h+q/2-m,u||t||a.clearRect(b,c,i,j),a[s](b,c,i,j),b=g-n-f-k,c=h+q/2-m,u||t||a.clearRect(b,c,i,j),a[s](b,c,i,j)),this.hasRotatingPoint&&!this.lockRotation&&(b=g+r/2-n,c=this.flipY?h+q+this.rotatingPointOffset/this.scaleY-j/2+f+l:h-this.rotatingPointOffset/this.scaleY-j/2-f-l,u||t||a.clearRect(b,c,i,j),a.drawImage(G,b,c,i,j),a[s](b,c,i,j)),a.restore(),this}};jQuery.fn.fancyProductDesigner=function(c){return this.each(function(){var d=a(this);if(!d.data("fancy-product-designer")){var e=new b(this,c);d.data("fancy-product-designer",e)}})},a.fn.fancyProductDesigner.defaults={_useChosen:!0,textSize:18,fontDropdown:!0,fonts:["Arial","Helvetica","Times New Roman","Verdana","Geneva"],customTextParameters:{},customTexts:!0,editorMode:!1,elementParameters:{x:0,y:0,colors:!1,removable:!1,draggable:!1,rotatable:!1,resizable:!1,zChangeable:!1,scale:1,degree:0,price:0,boundingBox:!1,autoCenter:!1,font:!1,textSize:18,patternable:!1,z:!1},labels:{outOfContainmentAlert:" is out of his containment!",confirmProductDelete:"Delete saved product?",modificationTooltips:{x:"x: ",y:" y: ",width:"width: ",height:" height: ",angle:"angle: "},colorpicker:{cancel:"Cancel",change:"Change Color"},uploadedDesignSizeAlert:"Sorry! But the uploaded image size does not conform our indication of size."},allowProductSaving:!0,centerInBoundingbox:!0,templatesDirectory:"templates/",saveAsPdf:!0,uploadDesigns:!0,customImagesParameters:{minW:100,minH:100,maxW:1500,maxH:1500,resizeToW:300,resizeToH:300},defaultFont:!1,dimensions:{sidebarNavWidth:50,sidebarContentWidth:200,sidebarHeight:650,productStageWidth:600,productStageHeight:600},facebookAppId:"",phpDirectory:"php/",patterns:[]}}(jQuery);